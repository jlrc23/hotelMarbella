!function(e,t){e.fn.mousewheel=function(i){var n,s=e(this),a=["DOMMouseScroll","mousewheel"],r="EventListener",o=function(e){return e=e||window.event,i(e,e.wheelDelta?e.wheelDelta/120:e.detail/3),e.preventDefault(),!1};s.on("mouseover mouseout",function(e){for(var i in a)e.target[e.target["add"+r]!==t?((n="mouseout"==e.type)?"remove":"add")+r:(n?"attach":"detach")+"Event"](a[i],o,!1)})}}(jQuery),function(e,t){"use strict";var i={mode:"continuous",thumbs:0,thumbsize:100,scheme:"dark",theme:"metro",size:"960,540",touch:!0,play:!0,autoplay:!1,share:!0,social:"fb,tw,gp,pin",duration:4e3,keyboard:!0,fullscreen:!0,margin:10,zoom:!0,fxspeed:400,grid:0,gridspace:4,gridorder:!0,captions:"title",info:!1,backlight:"#FFF",animation:"swipe",cors:!1,hashpath:"nch/",showhash:!0,bgclose:!1},n=[],s={title:!1,type:!1,play:!1,rel:!1,src:!1,href:!1,width:0,height:0,color:!1,effect:!1},a={},r={light:!1,current:!1,scrollbar:!0,all:{},phase:!0,css3:window.nchcss3,ns:e({}),event:{trigger:function(){r.ns.trigger.apply(r.ns,arguments)},on:function(){r.ns.on.apply(r.ns,arguments)},off:function(){r.ns.off.apply(r.ns,arguments)}},canFS:!1},o={},l={open:function(e){e.group.main.fadeIn(300)},close:function(e){var t;e.main.fadeOut(300),d.pause(!1);for(var i in e.set)(t=e.set[i].thumb)&&(t.className="")},slideOut:function(e,i){var n=d.getFX(e.opts.effect,e),s=e.group,a=s.css3,o=s.blocks.preview,l=r.phase?-1:1,c=n(0,0,0,1)!==t,u=function(e){return(c?n(0,0,0,e):e)+r.wsize};n(a,l,!0),o.stop().animate({scrollLeft:u(-l*r.wsize)},{duration:500,complete:function(){s.blocks.media.css("visibility","hidden"),n(a,0),i()}}),e.thumb!==t&&(e.thumb.className="")},slideIn:function(e,i){i=i===t?function(){}:i;var n=d.getFX(e.opts.effect,e),s=e.group,a=s.css3,o=s.blocks.preview,l=r.phase?1:-1,c=n(0,0,0,1)!==t,u=function(e){return(c?n(0,0,0,e):e)+r.wsize};n(a,l),s.blocks.media.css("visibility","visible"),a.el.offsetHeight+1,n(a,0,!0),s.blocks.media.css("visibility","visible"),o.stop().scrollLeft(u(-l*r.wsize)).animate({scrollLeft:u(0)},500,function(){o.scrollLeft(u(0))})}},c={youtube:{is:function(e){var t=e.opts.href.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/);return t?(e.opts.size||(e.opts.size=e.group.opts.size),e.opts.videoid=t[1],!0):!1},create:function(e){return"true"==e.opts.play?'<iframe class="nch-lb-iframe nch-video-youtube" src="http://www.youtube.com/embed/'+e.opts.videoid+'?autoplay=1&wmode=opaque" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>':'<iframe class="nch-lb-iframe nch-video-youtube" src="http://www.youtube.com/embed/'+e.opts.videoid+'?autoplay=0&mode=opaque" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>'},thumb:function(e,t){d.loadThumb.call(e,e.opts.src="http://img.youtube.com/vi/"+e.opts.videoid+"/hqdefault.jpg",t)}},vimeo:{is:function(e){var t=e.opts.href.match(/(http|https):\/\/(?:www.)?(?:(vimeo).com)\/(.*)/);return t?(e.opts.videoid=t[3],e.opts.size||(e.opts.size=e.group.opts.size),!0):!1},create:function(e){return"true"==e.opts.play?'<iframe class="nch-lb-iframe nch-video-vimeo" src="http://player.vimeo.com/video/'+e.opts.videoid+'?autoplay=1" width="500" height="500" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>':'<iframe class="nch-lb-iframe nch-video-vimeo" src="http://player.vimeo.com/video/'+e.opts.videoid+'?autoplay=0" width="500" height="500" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'},thumb:function(t,i){e.getJSON("http://vimeo.com/api/v2/video/"+t.opts.videoid+".json?callback=?",{format:"json"},function(e){d.loadThumb.call(t,t.opts.src=e[0].thumbnail_large,i)})}},dailymotion:{is:function(e){console.log(e);var t=e.opts.href.match(/^.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/);return null!==t?void 0!==t[4]?(e.opts.videoid=t[4],!0):(e.opts.videoid=t[2],!0):!1},create:function(e){return"true"==e.opts.play?'<iframe class="nch-lb-iframe nch-video-dailymotion" src="http://www.dailymotion.com/embed/video/'+e.opts.videoid+'?autoplay=1" width="500" height="500" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>':'<iframe class="nch-lb-iframe nch-video-dailymotion" src="http://www.dailymotion.com/embed/video/'+e.opts.videoid+'?autoplay=0" width="500" height="500" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'},thumb:function(e,t){d.loadThumb.call(e,e.opts.src="http://www.dailymotion.com/thumbnail/video/"+e.opts.videoid,t)}},html:{is:function(e){return e.opts.href=e.opts.href.replace(window.location,""),"#"==e.opts.href.charAt(0)||"."==e.opts.href.charAt(0)},create:function(t){return e(t.opts.href).show().get(0)}},ajax:{is:function(e){return e.opts.href.search(/^https?:\/\//i)<0},create:function(t,i){e.ajax({url:t.opts.href,success:i})}},iframe:{is:function(){return!0},create:function(e){return'<iframe class="nch-lb-iframe" src="'+e.opts.href+'" frameBorder="0"></iframe>'}}},u={init:function(n){var a=arguments,o=e(this);if(0==o.length){if(n===t)return o;n.length===t&&1==a.length?e.extend(i,n):(o=d.setFrom.apply(this,[n.charAt!==t?[n]:n,a[1]||{}]),(a[1]||{}).open===t&&u.open.call(o))}else n=n||{},o.each(function(i,a){var o,l=e(a),c=l.is("img")?l:e("img",l);if(o=e.extend({},s,d.getDataProperties(l,{rel:"rel",title:"title",href:"href"})),c.length>0&&(o.src=c.attr("src")),(l.is("a")||0==c.length)&&(c=l),o.rel)r.all[o.rel]===t&&(r.all[o.rel]=new d.mediaGroup(n,o.rel)),r.all[o.rel].add(c,o);else{var u=new d.mediaGroup(n);u.add(c,o),r.all[u.name]=u}});for(var l in r.all)d.renderGrid(r.all[l]);return o},open:function(n){var s,a=e(this);if(n!==t&&r.all[n]!==t&&(s=r.all[n].set[0]),a.data("nch-lb-media")!==t)s=a.data("nch-lb-media");else if(this.jquery)return u.init.apply(this,arguments),u.open.call(this);s&&(r.event.trigger("open",s.group),window.location.hash="#"+i.hashpath+s.opts.hash),r.scrollpos=r.w.scrollTop(),r.doc.addClass("nch-lb-noscroll")},next:function(e){if(r.current){var n=r.current,s=n.set.length,a=n.current,o=n.set[a+1==s?0:a+1];window.location.hash="#"+i.hashpath+o.opts.hash,d.pause(e===t),r.phase=!0,r.event.trigger("next",[r.current,o])}},previous:function(){if(r.current){var e=r.current,t=e.set.length,n=e.current,s=e.set[0==n?t-1:n-1];window.location.hash="#"+i.hashpath+s.opts.hash,d.pause(!1),r.phase=!1,r.event.trigger("previous",[r.current,s])}},close:function(){if(r.current){var e=r.current;window.location.hash="",history&&history.pushState&&history.pushState("",document.title,window.location.pathname+window.location.search),e.playing&&u.play(),d.fs.on&&d.fs.toggle(),d.detachMedia(e.set[e.current]),r.event.trigger("close",e),l.close(e),r.current.paused=!1,r.current=e.current=!1,r.doc.removeClass("nch-lb-noscroll"),r.w.scrollTop(r.scrollpos)}},fx:function(i,n){n===t?e.extend(o,i):o[i]=n},access:function(e,i){return e!==t&&(d[e]=i),d},play:function(e){var i=r.current,n=i.opts,s=i.main,a=i.blocks.loading,o=i.playing,l=n.duration;if(n.play)return e===t&&o?o:(s.toggleClass("nch-lb-playing"),o?a.stop():a.animate({width:s.width()},{easing:"linear",duration:(1-a.width()/s.width())*l,complete:function(){i.paused=!0,u.next()}}),e!==!1&&r.event.trigger(o?"stop":"play",i),i.playing=!o)},stop:function(){return r.current.playing&&u.play(!0),!1},info:function(){return r.current?d.toggleInfo.apply({},arguments):void 0},addEvent:function(e,t){r.event.on(e,t)},removeEvent:function(e,t){r.event.off(e,t)},getGroupName:function(){var i,n=e(this),s=!1;return n.length>0?(i=e(n.get(0)).data("nch-lb-media"))!==t?i.group.name:s:s},getMediaId:function(){var i,n=e(this),s=!1;return n.length>0?(i=e(n.get(0)).data("nch-lb-media"))!==t?i.opts.hash:s:s}},h="",d={toggleInfo:function(e){var i=r.current,n=i.blocks,s=n.info.children(".nch-lb-info-panel");return e!==t&&i.about==e?e:(n.info["fade"+(i.about?"Out":"In")](400),s.append(i.info.show()),r.event.trigger((i.about?"close":"open")+"_info",[i]),i.about=!i.about)},selectThumb:function(i){var n,s=i.thumb,a=i.group,r=a.blocks,o=0,l=e(s),c=l.parent(),u=c.prev().find("img").get(0),h=c.next().find("img").get(0);if(s!==t&&a.opts.thumbs){for(var d in a.set)(n=a.set[d].thumb)&&(n.className="");var p,f,m,g=(s.className="nch-lb-thumb-s",a.opts),y={top:1,bottom:1,left:0,right:0}[g.thumbs],v=r.bthumbs,b=(r.thumbs,v[y?"width":"height"]()),w=y?"left":"top",x="offset"+(y?"Width":"Height"),T={};o=v[f="scroll"+w.substr(0,1).toUpperCase()+w.substr(1)](),m=l.position()[w];var j=m-4,C=m+(p=s[x])+4;u!==t&&(j-=u[x]+4),h!==t&&(C+=h[x]+4),C-j>b?T[f]=m+s[x]/2-b/2:o>j?T[f]=j:C-b>o&&(T[f]=C-b),v.animate(T,200)}},scrollThumbs:function(e,t){var i,n=r.current,s=n.opts,a=s.thumbs,o={left:"Top",top:"Left",right:"Top",bottom:"Left"};n&&a&&(i=n.blocks.bthumbs,i["scroll"+o[a]](i["scroll"+o[a]]()+120*t))},useTouch:function(n){var s;n.hammer({prevent_default:!0}).on("dragstart",function(a){function o(e){return(p=e.gesture)?(f=p.deltaX,((m=Math.abs(f))>25||g)&&(g=!0,n.stop().scrollLeft(T(-f)),w(b,f/r.wsize)),void 0):!1}function l(){var e=r.current.set.length,t=r.current.current;m>y&&e>1&&("linear"==r.current.opts.mode?!(0==t&&f/m>0||t==e-1&&0>f/m):1)?(c=f>0?0:2*r.wsize,n.animate({scrollLeft:T(c-r.wsize)},i.fxspeed,function(){u[0>f/m?"next":"previous"](!0)}),w(b,f/m,!0)):(n.stop().animate({scrollLeft:T(0)},i.fxspeed),w(b,0,!0)),n.off("drag",o).off("dragend",l)}if(a.gesture===t)return!1;if(s===t&&(s=!(a.gesture.srcEvent.changedTouches===t))&&r.b.addClass("nch-lb-photo-menu-visible"),r.zooming||!r.current||a.gesture===t)return!0;var c,h,p,f,m,g=(e(a.target),a.timeStamp,!1),y=r.wsize/3,v=r.current,b=v.css3,w=d.getFX(v.set[v.current].opts.effect,v.set[v.current]),x=w(0,0,0,1)!==t,T=function(e){return(x?w(0,0,0,e):e)+r.wsize};return h=a.gesture,n.on("drag",o).on("dragend",l),!1})},pause:function(e){r.current.playing&&!r.current.paused&&((e===!0||"mouseover"==e.type)&&(r.current.paused=!0),u.play(!1))},resume:function(){!r.current.playing&&r.current.paused&&(u.play(!1),r.current.paused=!1)},openShare:function(t){if(r.current){var i,n=r.current,s=n.current,a=n.set[s];"nch-lb-icon-share"==t.target.className?a.share&&"block"==a.share.css("display")?(a.share.hide(),n.main.removeClass("nch-lb-sharing")):(n.main.addClass("nch-lb-sharing"),a.share||(a.share=i=e('<div class="nch-lb-share-btns"></div>').appendTo(e("li.nch-lb-share",n.blocks.menu)),d.shareButtons(i,n.opts.social,d.getMediaProperties(a))),a.share.show()):a.share&&(a.share.hide(),n.main.removeClass("nch-lb-sharing"))}},renderGrid:function(i){var n,s,a,r,o=i.opts,l=i.set,c=!1,h=[];if(o.grid&&!i.hasGrid){i.hasGrid=!0,n=o.grid.split(",");for(var p in n)n[p]=parseInt(n[p]);d.need(i.set,d.getThumbnail,function(){for(var i in l)l[i].thumb!==t&&(s=l[i].main.hide(),c||(c=s),a=e(l[i].thumb).clone(!0).data("nch-lb-media",l[i]).click(u.open).get(0),a.title=l[i].opts.title?l[i].opts.title:"",h.push(a));e('<div class="nch-lb-grid"></div>').insertAfter(c).append(r=e(h)),r.nchgrid({grid:n,margin:o.gridspace,order:o.gridorder,captions:o.captions})})}},parseColor:function(e){for(var t,i=(e+"").split(/bg|\_|\-|\.|\&|\#/),n=0;n<i.length;n++)if((6==(t=i[n].length)||3==t)&&new RegExp("[a-f0-9]{"+t+"}").test(i[n]))return"#"+i[n];return!1},toggleZoom:function(){var t=r.current,i=t.main,n="nch-lb-zooming",s=t.set[t.current];if(s.nsize,i.hasClass(n))r.zooming=!1,d.updateMediaLayout(s),t.blocks.zoom.find(".nch-lb-zoom-container").remove();else{r.zooming=!0;var a,o=new Image;o.onload=function(){a=d.pinch.call(e(o),"100%","100%").css({position:"absolute"}).addClass("nch-lb-zoom-container"),t.blocks.zoom.append(a)},o.src=s.target.src}i.toggleClass(n)},getMediaProperties:function(e){var t=e.opts,i=t.type,n={title:t.title||document.title,media:"html"!=i&&"ajax"!=i?"image"==i||"iframe"==i?e.target.src:t.href:""};return n.url="youtube"==i||"vimeo"==i||"dailymotion"==i||"iframe"==i?n.media:window.location.href,n},detachMedia:function(t){var i=t.group,n=i.main;e(".nch-lb-title",n).each(function(){e(this).html("")}),e(t.target).detach()},getInnerHeight:function(e,t){e.css({width:t,height:"auto"});var i=e.height();return e.css({height:"auto"}),i},getInnerWidth:function(e,t){e.css({height:t,width:1});var i=e[0].scrollWidth;return e.css({width:"auto"}),i},renderMedia:function(t){function i(i){t.html=i,t.target=e(i)[0],n()}function n(){p.attr("class","nch-lb-media").addClass("nch-lb-media-"+f.type).append(t.target),o.paused&&(u.play(!1),u.play(!1),o.paused=!1),d.updateMediaLayout(t)}var s,a,o=r.current,l=o.main,h=o.blocks,p=h.media,f=t.opts,m=f.type;e(".nch-lb-title",l).each(function(){e(this).html(f.title)}),h.loading.width(0),t.target?n():"youtube"==m||"vimeo"==m||"dailymotion"==m?(t.target=s=e(c[m].create(t)).get(0),a=function(){n(),this.onload&&(this.onload=function(){})},s.attachEvent?s.attachEvent("onload",a):s.onload=a,r.root.append(s)):"iframe"==m?(t.target=s=e(c[m].create(t)).get(0),n()):("html"==m||"ajax"==m)&&("html"==m?i(c[m].create(t)):c[m].create(t,i))},fitInto:function(e,t,i,n){var s,a,r=e/t,o=i/n;return r>o?(s=i>e?e:i,a=s/r):(a=n>t?t:n,s=a*r),[s,a]},updateMediaLayout:function(t){var i,n,s,a,o=!1,l=r.current,c=l.blocks,u=(c.preview,c.media),h=l.mspace.width,p=l.mspace.height,f=t.opts,m=f.type,g={top:0,left:0,width:0,height:0},y=t.nsize;if(r.zooming)return!0;if(("youtube"==m||"vimeo"==m||"dailymotion"==m)&&(y=t.nsize=t.group.opts.size.split(",")),a=isNaN(f.width)||isNaN(f.height),"image"==m||"youtube"==m||"vimeo"==m||"dailymotion"==m){var v=y[0]/y[1];0==f.width&&0==f.height?(s=d.fitInto(y[0],y[1],h,p),g.width=s[0],g.height=s[1]):0==f.height?(g.width=h<f.width?h:f.width,g.height=g.width/v>p?(g.width=p*v)/v:g.width/v):0==f.width?(g.height=p<f.height?p:f.height,g.width=g.height*v>h?(g.height=h/v)*v:g.height*v):a||(s=d.fitInto(f.width/1,f.height/1,h,p),g.width=s[0],g.height=s[1])}else"iframe"==m?(0==f.width?g.width=h:a||(g.width=f.width>h?h:f.width),0==f.height?g.height=p:a||(g.height=f.height>p?p:f.height)):("html"==m||"ajax"==m)&&t.target&&(o=!0,f.width>0&&(g.width=f.width>h?h:f.width),f.height>0&&(g.height=f.height>p?p:f.height));if(a&&(f.width/1?g.width=f.width/1:f.height/1&&(g.height=f.height/1),i=isNaN(f.width)?parseFloat(f.width)/100*h:0,n=isNaN(f.height)?parseFloat(f.height)/100*p:0,n&&i?(n||(n=i/y[0]*y[1]),i||(i=n*y[0]/y[1]),s=d.fitInto(i,n,h,p),g.width=s[0],g.height=s[1]):n?i=g.width?g.width:n*y[0]/y[1]:i&&(n=g.height?g.height:i/y[0]*y[1]),s=d.fitInto(i,n,h,p),g.width=s[0],g.height=s[1]),o){g.width||g.height||(g.width=Math.min(h,p));var b=e('<div style="display:block;position:relative;padding:1px"></div>').append(e(t.target).clone()).appendTo(r.root);g.width||(g.width=Math.min(d.getInnerWidth(b,g.height),h)),g.height||(g.height=Math.min(d.getInnerHeight(b,g.width),p)),b.remove()}if(g.top=r.mposy=(p-g.height)/2,g.left=r.wsize+l.mspace.left+(h-g.width)/2,t.group.main[("image"==m&&(y[0]>g.width||y[1]>g.height)&&l.opts.zoom?"add":"remove")+"Class"]("nch-lb-can-zoom"),u.css(g),"iframe"==m||"youtube"==m||"vimeo"==m||"dailymotion"==m){var w=e("iframe.nch-lb-iframe",u);isNaN(g.height)?w.height("100%"):w.height(g.height),isNaN(g.width)?w.width("100%"):w.width(g.width)}},getMediaColor:function(e,t){var n=e.opts;return n.color?t(n.color):("image"==n.type&&r.hasCanvas?d.getMainColor(e.target,function(e){t("rgb("+e.join(",")+")")}):t(i.backlight),void 0)},enoughThumbs:function(e){for(var t=0,i=0;i<e.set.length;i++)e.set[i].opts.src&&t++;return t>1?!0:(e.opts.thumbs=!1,!1)},toMedia:function(e){function t(){e.group.main&&e.group.blocks.media.css({width:0,height:0}),0==e.group.main&&(d.renderLayout(e.group),d.selectThumb(e)),r.current!==e.group?(r.current&&l.close(r.current.group),r.current=e.group,r.current.current=e.index,l.open(e)):a=e.group.current,d.updateLayout(),s===!1?s=!0:s!==!0&&s()}function i(t){e.opts.type=t,d.renderMedia(e),d.updateMediaLayout(e),l.slideIn(e,function(){}),d.getMediaColor(e,function(t){function i(){d.light(e.opts.color)}e.opts.color=t,r.light===!1?r.event.on("maskload",i):i()}),r.current.current=e.index}var n,s=!1,a=!1;u.open.call(e),d.enoughThumbs(e.group),r.current&&r.current==e.group&&(a=r.current.current)!==!1&&(r.phase=a&&e.index||a+e.index!=e.group.set.length-1?a<e.index:a>e.index),e.group.main&&d.selectThumb(e),r.zooming&&d.toggleZoom(),r.current?l.slideOut(n=r.current.set[r.current.current],function(){d.detachMedia(n),t()}):t(),d.getMediaType(e,function(e){var t=function(){i(e)};s===!0?t():s=t})},renderLayout:function(t){var i,n=t.main=e('<div class="nch-lb-main"></div>').appendTo(r.b),s=t.opts,a="",o={};o.loadicon=e('<div class="nch-lb-media-loading"></div>').appendTo(n),r.canFS&&s.fullscreen&&(a+="nch-lb-can-fs "),s.share&&(a+="nch-lb-can-share "),s.play&&t.set.length>1&&(a+="nch-lb-can-play "),s.zoom&&(a+="nch-lb-can-zoom "),s.info&&(a+="nch-lb-has-info "),r.scrollbar||(a+="nch-lb-no-scrollbar "),n.addClass(a);var l={v:"vertical",h:"horizontal"},c={left:"v",right:"v",top:"h",bottom:"h"},h={v:"width",h:"height"};if(r.asb){var p=o.asb=e('<div class="nch-lb-pngfix"></div>').appendTo(n);d.css3(p).transition("background-color 500ms linear")}s.info&&(t.info=(i=e("#"+s.info)).length?i:e("<div></div>"));var f,m=o.tbar=e('<div class="nch-lb-tbar"></div>').appendTo(n),g=e('<ul class="nch-lb-tbar-controls"></ul>'),y=o.bbar=e('<div class="nch-lb-bar"></div>').appendTo(n),v=o.controls=e('<ul class="nch-lb-controls"></ul>').appendTo(y),b={prev:"left",play:"play",next:"right",title:!1,exit:"exit",fs:"fs",info:"info"};1==t.set.length&&n.addClass("nch-lb-no-more");for(var w in b)v.append(f='<li class="nch-lb-'+w+'">'+(b[w]?'<div class="nch-lb-icon-'+b[w]+'"></div>':"")+"</li>"),("exit"==w||"title"==w||"info"==w||"fs"==w)&&g.append(f);if(s.thumbs){var x=o.thumbs=e('<ul class="nch-lb-thumbs"></ul>'),T=o.bthumbs=e('<div class="nch-lb-thumbs-bar"></div>').append(x);if(T.addClass("nch-lb-thumbs-"+s.thumbs).css(s.thumbs,0),x.addClass("nch-lb-thumbs-"+l[c[s.thumbs]]).css(h[c[s.thumbs]],s.thumbsize),"bottom"==s.thumbs?y.append(T):"top"==s.thumbs?m.append(T):n.append(T),"v"==c[s.thumbs]){var j={left:"auto",right:"auto"};j["left"==s.thumbs?"right":"left"]=T[h[c[s.thumbs]]](),m.css(j),y.css(j)}}g.appendTo(m);var C,k=o.preview=e('<div class="nch-lb-media-space"></div>').appendTo(n);o.scroller=e('<div class="nch-lb-media-scroller"></div>').appendTo(k).append(C=o.media=e('<div class="nch-lb-media"></div>')),t.css3=d.css3(C);for(var _=o.menu=e('<ul class="nch-lb-photo-menu"></ul>').appendTo(C),Q=["zoom","share"],w=0;w<Q.length;w++)_.append('<li class="nch-lb-'+Q[w]+'"><div class="nch-lb-icon-'+Q[w]+'"></li>');o.info=e('<div class="nch-lb-project"><div class="nch-lb-info-panel"><div class="nch-lb-icon-close"></div></div></div>').appendTo(n),o.loading=e('<div class="nch-lb-loadbar"></div>').appendTo(n),C.on("mouseover",d.pause).on("mouseout",d.resume),t.blocks=o,s.thumbs&&d.need(t.set,d.getThumbnail,function(){d.renderThumbnails(t)}),o.zoom=e('<div class="nch-lb-zoom-space"><div class="nch-lb-icon-zoom"></div></div>').appendTo(n),s.autoplay&&(t.playing=!0,t.paused=!0,n.addClass("nch-lb-playing")),e("div.nch-lb-icon-fs",n).each(function(){e(this).click(d.fs.toggle)}),e("li.nch-lb-exit",n).each(function(){e(this).click(u.close)}),e("li.nch-lb-prev",v).click(u.previous),e("li.nch-lb-next",v).click(u.next),e("li.nch-lb-play",v).click(u.play),e("div.nch-lb-icon-info",n).each(function(){e(this).click(d.toggleInfo)}),e("div.nch-lb-icon-close",n).each(function(){e(this).click(d.toggleInfo)}),e("div.nch-lb-icon-zoom",n).hammer().on("tap",d.toggleZoom),n.hammer().on("tap",d.openShare),s.touch&&d.useTouch(o.preview),s.bgclose&&d.backgroundClose(o)},backgroundClose:function(e){e.preview.click(function(e){e.target.className.search("nch-lb-media-space")>=0&&u.close()})},fs:{on:!1,request:function(e){return d.fs.on=!0,e.requestFullScreen?e.requestFullScreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?1==e.webkitRequestFullScreen.length?e.webkitRequestFullScreen():e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.mozRequestFullScreen?e.mozRequestFullScreen():d.fs.on=!1},has:function(){var e=d.fs.request(document.documentElement);return 0!=e},exit:function(){var e=document;e.cancelFullScreen?e.cancelFullScreen():e.exitFullscreen?e.exitFullscreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.mozCancelFullScreen&&e.mozCancelFullScreen(),d.fs.on=!1},toggle:function(){var e="nch-lb-onfs",t=r.current.main;d.fs.on?(t.removeClass(e),d.fs.exit()):(t.addClass(e),d.fs.request(document.documentElement))}},loadThumb:function(e,t){var i;this.thumb=i=new Image,i.onload=t,i.src=e},updateLayout:function(i){function n(){r.asb||p.append(r.light[0].$el.height(f[2]+100),r.light[1].$el.height(f[2]+100))}var s=r.current,a=r.wsize=r.w.width(),o=r.hsize=r.w.height();if(s){var l,c=s.blocks,u=c.preview,h=s.opts,p=h.margin,f=[p,p,p,p],p=s.main,m=c.bthumbs,g={top:0,right:1,bottom:2,left:3},y="height",v="width",b=[y,v,y,v];m!==t&&"bottom"!=h.thumbs&&"top"!=h.thumbs&&(f[g[h.thumbs]]+=m[b[g[h.thumbs]]]()),f[0]+=c.tbar.height(),f[2]+=c.bbar.height(),l={top:f[0],left:f[3],width:a-f[1]-f[3],height:o-f[0]-f[2]},c.bbar.width(l.width+2*h.margin),c.tbar.width(l.width+2*h.margin),u.css(e.extend({},l,{left:0,width:a,height:l.height+40})),c.loadicon.css({left:l.left+l.width/2,top:l.top+l.height/2}),s.mspace=l,r.hasCanvas&&(r.light?n():r.event.on("maskload",n)),0!=s.set[s.current].opts.type&&s.set[s.current].target&&d.updateMediaLayout(s.set[s.current]),i!==t&&u.scrollLeft(r.wsize)}},light:function(e,t){if(r.hasCanvas){if(r.asb&&r.current){var i=r.current.blocks.asb.get(0);return i.style.backgroundColor=e,void 0}var n=arguments,s={opacity:1,display:"block"},a={opacity:0},o=r.light[0],l=r.light[1];2==n.length?e.main.append(o.$el,l.canvas):t=e;var e=[0,0,l.width,l.height];l.$el.stop().animate(a,500,function(){d.toColor(l,t),l.$el.css(s),o.$el.hide()}),d.toColor(o,t),o.$el.stop().show().css(a).animate(s,500)}},toColor:function(e,t){var i=e.width,n=e.height,s=e.context;s.clearRect(0,0,i,n),s.fillStyle=t,s.fillRect(0,0,i,n),e.mask()},masks:function(){var t=this,i=(e("div.nch-lb-mask"),e('<canvas class="nch-lb-effcurrent"></canvas>')),n=e('<canvas class="nch-lb-effchange"></canvas>');r.color="#000",r.light=r.asb?[]:[new d.canvasMask(i,t),new d.canvasMask(n,t)],r.event.trigger("maskload")},getImageURL:function(e){var t=/^url\((['"]?)(.*)\1\)$/.exec(e.css("background-image"));return t?t[2]:""},hashChange:function(){var e="";window.setInterval(function(){e!=window.location.hash&&0==(e=window.location.hash).search("#"+i.hashpath)&&d.route(e.replace("#",""))},150)},route:function(e){if(a[e]!==t){var i=a[e];d.toMedia(i.call!=t?i():i)}},addRoute:function(e,t){a["nch_"+e]=t},isImage:function(e,n,s){var a=new Image,r=function(){n("image")};a.onerror=s||function(){d.getMediaType(e,n,!0)},a.onload=function(){e.target=this,e.nsize=[this.width,this.height],s===t&&!d.allowedOrigin(this)&&i.cors?d.isImage(e,n,r):n("image")},s!==t&&(a.crossOrigin="anonymous"),a.src=e.opts.href},getMediaType:function(e,i,n){var s=e.opts;if(0!=s.type)return e.target||("youtube"==s.type||"vimeo"==s.type||"dailymotion"==s.type)&&s.videoid===t&&c[s.type].is(e),i(s.type);if(n){for(var n in c)if(c[n].is(e))return i(n)}else d.isImage.apply(this,arguments)},need:function(e,t,i){for(var n=e.length-1,s=0,a=function(){s++==n&&i()},r=0;n>=r;r++)t(e[r],a)},getThumbnail:function(e,i){var n=new Image,s=e.opts,a=s.type,r=function(){i(e)};return e.thumb!==t?i(e):(s.src?(n.onload=r,n.src=s.src,e.thumb=n):"youtube"==a||"vimeo"==a||"dailymotion"==a?(e.opts.videoid===t&&c[a].is(e),c[a].thumb(e,r)):i(e),void 0)},renderThumbnails:function(i){var n,s,a=(i.main,i.opts),r=i.blocks,o=r.thumbs.empty(),l=0,c={bottom:1,top:1,left:0,right:0};o[c[i.opts.thumbs]?"height":"width"](i.opts.thumbsize),window.setTimeout(function(){for(var r in i.set)(n=i.set[r].thumb)!==t&&(s=(n.naturalWidth||n.width)/(n.naturalHeight||n.height),l+=a.thumbsize*(c[i.opts.thumbs]?s:1/s)+8,o.append(e("<li></li>").append(e(i.set[r].thumb).removeAttr("width","height").data("nch-lb-media",i.set[r]).click(u.open))));o[c[i.opts.thumbs]?"width":"height"](l-6)},25),o.hammer({prevent_default:!1}).on("drag",function(){return!0}),o.mousewheel(d.scrollThumbs)},getFX:function(e,t){if(e===!1&&(t.opts.effect=e=t.group.opts.animation),"random"==e){var i=[];for(var n in o)i.push(n);t.opts.effect=t.opts.animation=e=i[Math.round(Math.random()*(i.length-1))]}return o[e]||function(){}},mediaGroup:function(t,n){var s,r,o,l=this;n||(n=d.randomName()),this.main=!1,this.name=s=n,this.opts=r=e.extend({},i,t),this.current=!1,this.set=[],this.playing=!1,this.paused=!1,this.about=!1,this.add=function(e,t){var n=new d.mediaItem(e,d.inheritProps(r,t));n.group=l,n.opts.rel=s,n.index=l.set.length,n.opts.href||(n.opts.href=n.opts.src),(o=d.parseColor(n.opts.href+n.opts.src))&&(n.opts.color=o),a[i.hashpath+n.opts.hash]=n,l.set.push(n)}},allowedOrigin:function(t){if(!r.hasCanvas)return!0;var i=r.tcanvas,n=i.getContext("2d"),s=i.width,a=i.height;n.clearRect(0,0,s,a),n.drawImage(t,0,0);try{n.getImageData(0,0,1,1)}catch(o){return e(r.tcanvas).remove(),e(r.tcanvas=document.createElement("canvas")).addClass("nch-lb-testcanvas").appendTo(r.b),!1}return!0},inheritProps:function(e,i){for(var n in e)i[n]!==t&&(e[n]=i[n]);return i},mediaItem:function(t,i){var n;this.main=t,this.opts=n=e.extend({hash:d.getHash(i)},s,i),this.target=!1,this.share=!1,t.data("nch-lb-media",this),t.click(function(e){return e.preventDefault(),u.open.call(this),!1})},keyboard:function(e){var t=e.which,i=r.current;i&&i.opts.keyboard&&(32==t&&i.opts.play&&u.play(),37==t&&u.previous(!0),39==t&&u.next(!0),27==t&&u.close())},setFrom:function(i,n){var s,a=e(),o=new d.mediaGroup(n);for(var l in i)i[l].charAt!==t&&(i[l]={href:i[l]}),s=e('<a href="'+i[l].href+'"></a>'),i[l].src&&s.append('<img src="'+i[l].src+'">'),o.add(s,i[l]),a=a.add(s);return r.all[o.name]=o,a},randomName:function(){return"nch_group_"+Math.round(Math.random()*(new Date).getTime())},getHash:function(e){var s,r,o=e.href?e.href:e.href=e.src,l=0;if(e.hash?1:0,o===t||0==(o+"").length)return l;for(s=0;s<o.length;s++)r=o.charCodeAt(s),l=(l<<5)-l+r,l&=l;if(l=Math.abs(l),a[i.hashpath+l]!==t)for(;a[i.hashpath+l]!==t;)l++;return n.push(l),l},getDataProperties:function(t){t.jquery&&(t=t.get(0));for(var i,n=arguments,s=n[1]?n[1]:[],a={},r=0;r<t.attributes.length;r++){var o=t.attributes[r].name;(s[o]||e.inArray(o,s)>=0||0==o.search("data-"))&&(a[s[o]?s[o]:o.replace("data-","")]=(i=t.getAttribute(o))==parseInt(i)?parseInt(i):i)}return a},canvasMask:function(e,t){if(r.hasCanvas){var i,n,s;this.$el=e,this.canvas=e=e.get(0),this.context=i=e.getContext("2d"),this.mask=t,this.width=n=e.width=t.width,this.height=s=e.height=t.height,i.drawImage(t,0,0),this.maskdata=function(e){for(var t=[],i=0,a=0;s>a;a++)for(var r=0;n>r;r++,i+=4)t.push(e.data[i]);return t}(i.getImageData(0,0,n,s)),i.clearRect(0,0,n,s),this.mask=function(){for(var e=this.maskdata,t=4*e.length,a=0,r=i.getImageData(0,0,n,s);t>a;)r.data[a+3]*=e[a/4]/255,a+=4;i.putImageData(r,0,0)}}},hexToRGB:function(e){var t=e.replace("#",""),i=t.match(/.{1,1}/g);t.length/3<2&&(t=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),t=t.match(/.{1,2}/g);for(var n=0;3>n;n++)t[n]=parseInt(t[n],16);return t},drawImageOnto:function(e,t,i,n,s,a,r){var o=this,l=arguments;try{e.drawImage(t,i,n,s,a)}catch(c){return window.setTimeout(function(){d.drawImageOnto.apply(o,l)},0),void 0}r()},getMainColor:function(e,t){var i,n,s,a=document.createElement("canvas"),o=a.getContext("2d"),l=0,c=0,u=a.width=200,h=a.height=200,p=[0,0,0],f=d.hexToRGB(r.current.opts.backlight);return a.getContext&&o?(d.drawImageOnto(o,e,0,0,200,200,function(){try{i=o.getImageData(0,0,u,h)}catch(e){return t(f)}for(var a=0;h>a;a++)for(var r=0;u>r;r++)n=(i.data[l]+i.data[l+1]+i.data[l+2])/3,s=Math.abs(n-i.data[l])+Math.abs(n-i.data[l+1])+Math.abs(n-i.data[l+1]),s>c&&(c=s,p=[i.data[l],i.data[l+1],i.data[l+2]]),l+=4;t(p)}),void 0):t(f)}};e.fn.nchlightbox=function(e){return u[e]?u[e].apply(this,Array.prototype.slice.call(arguments,1)):u.init.apply(this,arguments)},e.fn.nchlightbox.defaults=i,e(document).ready(function(){e(".nch-hide-if-javascript").hide(),r.b=e("body"),r.w=e(window).resize(d.updateLayout),r.doc=e(document.documentElement),d.hashChange();var i;r.asb=(i=navigator.userAgent.toLowerCase()).search("android")>0&&i.search("mobile safari")>0&&i.search("linux")>0&&i.search("chrome")<0;var n=document.createElement("canvas"),s=r.root=e('<div class="nch-lb-mask"></div>').appendTo(r.b);(r.hasCanvas=!(!n.getContext||!n.getContext("2d")))?(h=new Image,h.onload=d.masks,h.src=d.getImageURL(s),e(r.tcanvas=document.createElement("canvas")).addClass("nch-lb-testcanvas").appendTo(r.b)):d.masks(),r.canFS=d.fs.has(),d.fs.on=!1,r.w.keyup(d.keyboard);var a=e('<div class="nch-lb-scrollbars"></div>').appendTo(r.b),o=a.get(0).clientWidth,l=a.get(0).offsetWidth;o!==t&&l!==t&&l==o&&(r.scrollbar=!1),a.remove(),e(".nch-lightbox").nchlightbox()})}(jQuery),function(e,t,i,n){function s(e){for(var t=e.split("-"),i=1;i<t.length;i++)t[i]=t[i].substr(0,1).toUpperCase()+t[i].substr(1);return t.join("")}function a(e,t){var a,r=e,o=t||["ms","O","Moz","Webkit","Khtml"],c=(e=s(r)).substr(0,1).toUpperCase()+e.substr(1),u=i.documentElement;if(u.style[e]!==n)return l[r]=r,e;a=(o.join(c+"/")+c).split("/");for(var h in a)if(u.style[a[h]]!==n)return l[r]="-"+o[h].toLowerCase()+"-"+r,a[h];return!1}var r={},o={},l={},c={rotate:"deg",rotateX:"deg",rotateY:"deg",skewX:"deg",skewY:"deg",perspective:"px",scale:"",translateX:"px",translateY:"px",translateZ:"px"};!function(){for(var e=arguments,t=0;t<e.length;t++)o[e[t]]=a(e[t])}("transform","perspective","transition","transform-origin"),r.transform=function(e,t){var i=t===n?e:function(i){return i[e]=t,i}({}),s=[];if(o.transform!==!1){for(var a in i)c[a]!==n&&(i[a]+"").search(c[a])<0&&(i[a]+=c[a]),s.push(a+"("+i[a]+")");this.style[o.transform]=s.join(" ")}},r.transition=function(e){this.style.setProperty===n?this.style[o.transition]=e:this.style.setProperty(l.transition,e)},r.transformOrigin=function(e){this.style.setProperty===n?this.style[o["transform-origin"]]=e:this.style.setProperty(l["transform-origin"],e)},r.perspective=function(e){o.perspective!==!1&&((e+"").search(c.perspective)<0&&(e+=c.perspective),this.style.setProperty===n?this.style[o.perspective]=e:this.style.setProperty(l.perspective,e))},r.animate=function(e,i,s){var a=this,i=i||400,o=[l.transform].join(",")+" "+i/1e3+"s "+"ease-in";r.transition.call(this,o),r.transform.call(this,e),t.setTimeout(function(){r.transition.call(a,"none"),s!==n&&s()},i)},e.fn.nchlightbox("access","css3",function(e){return new function(e){var t=this;this.el=e.jquery===n?e:(this.$el=e).get(0);for(var i in r)this[i]=function(e){return function(){r[e].apply(t.el,arguments)}}(i)}(e)})}(jQuery,window,document),function(e,t){function i(i,n,s){return function(a,r,o,l){if(l!==t)return 1==s?t:s*l;var c=n(r,Math.abs(r)),u=[c[0]];a.transformOrigin(c[2]||h),o&&u.push(i),c[0]!==t&&a[o?"animate":"transform"].apply({},u),c[1]!==t&&(u[0]=c[1],e.fn[o?"animate":"css"].apply(a.$el.stop(),u))}}var n="perspective",s="skewX",a="rotate",r="rotateX",o="rotateY",l="translateY",c="translateZ",u="opacity",h="50% 50%",d=400,p="scale";e.fn.nchlightbox("fx",{swipe:function(){},fade:i(d,function(e,i){var n={};return n[u]=1-i,[t,n]},1),scale:i(d,function(e,t){var i={};return i[p]=1-.6*t,[i]},1),slideUp:i(d,function(e){var t={};return t[l]=900*e,[t]},0),slideDown:i(d,function(e){var t={};return t[l]=-900*e,[t]},0),flip:i(d,function(e){var t={};return t[n]=1e3,t[o]=90*e,[t]},0),skew:i(d,function(e){var t={};return t[n]=1e3,t[s]=30*e,[t]},1),bounceDown:i(d,function(e,t){var i={};return i[n]=100,i[l]=1e3*t,[i]},1),bounceUp:i(d,function(e,t){var i={};return i[n]=100,i[l]=-1e3*t,[i]},1),hangLeft:i(d,function(e){var i={};return i[a]=-179*e,[i,t,"0% 0%"]},0),hangRight:i(d,function(e){var i={};return i[a]=-179*e,[i,t,"100% 0%"]},0),zoomIn:i(d,function(e,t){var i={},s={};return i[n]=800,i[c]=800*t,i[a]=45*e,s[u]=1-t,[i,s]},0),breakIn:i(d,function(e){var t={};
return t[a]=45*e,[t]},1),rotateIn:i(d,function(e,t){var i={};return i[n]=1e3,i[o]=90*e,i[p]=1-.3*t,[i]},1),rotateOut:i(d,function(e,t){var i={};return i[n]=1e3,i[o]=-90*e,i[p]=1-.3*t,[i]},1),cicleDown:i(d,function(e,t){var i={},s={};return i[n]=1200,i[r]=-90*e,i[l]=200*t,s[u]=1-t,[i,s,"50% 100%"]},0),cicleUp:i(d,function(e,t){var i={},s={};return i[n]=1200,i[r]=-90*e,i[l]=-200*t,s[u]=1-t,[i,s,"50% 1%"]},0),throwIn:i(d,function(e,t){var i={},s={};return i[n]=800,i[p]=1-.6*t,i[a]=180*e,s[u]=1-t,[i,s]},.3),fall:i(d,function(e,t){var i={},s={};return i[n]=1800,i[r]=-90*t,i[a]=90*e,i[c]=-400*e,s[u]=Math.pow(1-t,.25),[i,s,h]},0),jump:i(d,function(e,t){var i={};return i[n]=1500,i[p]=1-.999*t,i[l]=300*t,i[r]=100*t,i[c]=1e3*t,[i]},0)})}(jQuery),function(e){function t(e,t){for(var i="",n=!1,s="",a=0;a<e.length;a++)n?"}"==e.charAt(a)?(t[s]&&(i+=t[s]),n=!1,s=""):s+=e.charAt(a):"{"==e.charAt(a)?n=!0:i+=e.charAt(a);return i}function i(e){return"undefined"==typeof e.has.charAt?e.has():"undefined"!=typeof window[e.has]?!0:!1}function n(e){var t=document.createElement("script");t.async=!0,t.id=e.id,t.src=e.src,a.append(t)}function s(e,n,s){for(var a,n=n.split(","),o="",l=[],c=0;c<n.length;c++)(l[c]=i(a=r[n[c]]))&&(o+=t(a.create,s));e.append(o);for(var c in n)l[c]&&r[n[c]].parse(r[n[c]].api(),e.get(0))}var a,r={fb:{has:"FB",api:function(){return FB},parse:function(e,t){e.XFBML.parse(t)},id:"facebook-jssdk",src:"//connect.facebook.net/en_US/all.js",create:'<iframe class="fb-like" src="//www.facebook.com/plugins/like.php?layout=standard&amp;action=like&amp;show_faces=false&amp;share=false&amp;height=20&amp;href={url}" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:20px;" allowTransparency="true"></iframe>'},tw:{has:"twttr",api:function(){return twttr},parse:function(e,t){e.widgets.load(t)},id:"twitter-wjs",src:"//platform.twitter.com/widgets.js",create:'<a href="https://twitter.com/share" class="twitter-share-button" data-url="{url}" data-text="{title}" data-count="none">Tweet</a>'},gp:{has:function(){return"undefined"==typeof gapi||"undefined"==typeof gapi.plusone?!1:!0},api:function(){return gapi.plusone},parse:function(e,t){e.go(t)},id:"",src:"//apis.google.com/js/plusone.js",create:'<div class="g-plusone" data-size="medium" data-annotation="none" data-href="{url}"></div>'},pin:{has:function(){for(var e in window)if(0==e.search("PIN_"))return!0;return!1},api:function(){for(var e in window)if(0==e.search("PIN_")&&window[e].f)return window[e]},parse:function(t,i){for(var n,s=e(i).is("a")?[i]:i.getElementsByTagName("a"),a=t.f.render,r=0;r<s.length;r++)"undefined"!=typeof(n=e(s[r]).attr("data-pin-do"))&&a[n](s[r])},id:"",src:"//assets.pinterest.com/js/pinit.js",create:'<a href="//pinterest.com/pin/create/button/?url={url}&media={media}&description={title}" data-pin-do="buttonPin" data-pin-config="none"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png" /></a>'}};e(window).load(function(){var t;a=e("body");for(var o in r)t=r[o],i(t)||n(t);e.fn.nchlightbox("access","shareButtons",s)})}(jQuery),function(e,t,i){var n={grid:function(t,i){this.name="",this.set=t,this.opts=e.extend({},e.fn.nchgrid.defaults,i),this.images=[],this.items=[],this.cols=[],this.width=0,this.columns=0,this.filters=[],i.target||(this.opts.target=e(t.parent()))},column:function(){this.images=[],this.height=0,this.width=0,this.aspect=0,this.less=!1,this.addImage=function(e){this.images.push(e),this.aspect+=e.aspect}},getColumns:function(e,t){for(var i=0;t[i]<e;)i++;return i==t.length?i:i+1},resolveDeltaHeight:function(e,t,i,n){return(e+t*n)/(i+n)},spreadImages:function(e,t){var n=e.images,s=n.length;if(e.opts.order)for(var a=0;s>a;a++)t[a%e.columns].addImage(n[a]);else{for(var r,o=n.length,l=0,c=e.columns,u=[],a=0;c>a;a++)u.push({index:u.length,aspect:0});for(;o>l;){r=[];for(var a=0;c>a;a++)n[l+a]!=i&&r.push({aspect:1/n[l+a].aspect,index:l+a});r.sort(function(e,t){return e.aspect>t.aspect}),u.sort(function(e,t){return e.aspect<t.aspect});for(var a=0;a<r.length;a++)t[u[a].index].addImage(n[r[a].index]),u[a].aspect+=r[a].aspect;l+=c}}},renderGrid:function(t){var i=function(){n.updateGrid(t)};e(window).resize(i),i()},updateGrid:function(t){var i=t.opts,s=(t.set,t.images),a=i.target,r=t.cols,o=i.target.width();if(t.width!=o){if(t.columns=n.getColumns(t.width=o,i.grid),t.columns!=r.length){r=[];for(var l=0;l<t.columns;l++)r[l]=new n.column;n.spreadImages(t,r)}for(var c=t.width-(r.length-1)*i.margin,u=Math.floor(s.length/t.columns),h=0,d=0,l=0;l<t.columns;l++)(r[l].less=r[l].images.length==u)?h+=1/r[l].aspect:d+=1/r[l].aspect;for(var p,f,m,g=n.resolveDeltaHeight(c,i.margin,h,d),y=0,v=0,l=0;l<r.length;l++){f=r[l],all=f.images,p=1/f.aspect*(g-(f.less?0:i.margin)),v=0;for(var b=0;b<all.length;b++)m=e(t.items[all[b].index]).css({position:"absolute",left:y,top:v,width:p,height:p*all[b].aspect,display:"block"}).addClass("nchgrid-tile"),v+=p*all[b].aspect+i.margin;y+=p+i.margin}a.height(v-i.margin),"static"==a.css("position")&&a.css("position","relative")}},triggerClick:function(t){t.preventDefault(),e(t.target).is("img")||e(this).find("img").click()},loadTiles:function(){function t(t,a,r){var o,l;i.images[t]={width:a,height:r,aspect:r/a,src:i.set[t].src,index:t,caption:l=i.set[t].title},i.items[t]=(o=e('<div class="nchgrid-item"></div>').insertAfter(i.set[t]).append(i.set[t])).get(0),i.opts.captions&&(l+"").length?o.append('<div class="nchgrid-caption"></div><div class="nchgrid-caption-text">'+l+"</div>").click(n.triggerClick):o.append('<div class="nchgrid-caption"></div>').click(n.triggerClick),s++==i.set.length-1&&n.renderGrid(i)}var i=this,s=0;this.set.each(function(e,i){var n=new Image;n.onload=function(){t(e,this.width,this.height),i.style.display="block"},n.src=this.src,i.style.display="none"})}},s={init:function(t){var i=this;if(!this.length){var s,a=arguments,r=t,o=[];t=e.extend({},e.fn.nchgrid.defaults,2==a.length?a[1]:{});for(var l=0;l<r.length;l++)s=new Image,s.src=r[l],o.push(s);i=this.add(o).appendTo(t.target)}return n.loadTiles.call(new n.grid(i,e.extend({},e.fn.nchgrid.defaults,t||{}))),i}};e.fn.nchgrid=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):s.init.apply(this,arguments)},e.fn.nchgrid.defaults={margin:4,grid:[240,480,720,960,1240],captions:!1,order:!1,target:!1}}(jQuery,window),function(e,t,i,n){function s(e){2==(e.gesture.srcEvent.type+"").split("touch").length&&(l=!0),c.off("touch",s)}function a(t,i,s){function a(){v.cwidth=v.container.width(),v.cheight=v.container.height()}function r(e){return e=e===n?1:e,{e:[e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1]}}function c(e){return e.e.join(", ")}function u(e){var t=v.width*e-v.cwidth,i=v.height*e-v.cheight;S=-Math.abs(0>t?0:t),D=-Math.abs(0>i?0:i)}var h,d,p,f=1,m=0,g=0,y=!1,v=this;this._el=o(t),this.$el=t.css({display:"block"}),this.container=p=e("<div></div>").insertAfter(t).append(t),this._container=p.hammer({prevent_default:!0}),this.width=t.get(0).width||t.width(),this.height=t.get(0).height||t.height(),this.scale=1,this.centerX=.5,this.centerY=.5,this.translateX=0,this.translateY=0,this.transform=v.transform=r(),this._el.transformOrigin("0 0"),this.container.css({width:i||this.width,height:s||this.height,overflow:l?"hidden":"auto"});var b,w,x,T,j,C,k,_,m=0,g=0,Q=0,S=0,D=0,I=0,M=0,P=0,E=!1,A=!1;a(),this.transformStart=function(e){A&&(A=!1,v.dragEnd(e)),a(),E=!0,b=e.gesture.center.pageX,w=e.gesture.center.pageY,x=p.scrollLeft(),T=p.scrollTop(),j=p.offset(),C=j.left,k=j.top,v.centerX=h=(b-C-m-M)/v.width/v.scale,h=0>h?0:h>1?1:h,v.centerY=d=(w-k-g-P)/v.height/v.scale,d=0>d?0:d>1?1:d},this.drag=function(e){if(!E){y=e.gesture,M=y.deltaX+m+Q,P=y.deltaY+g+I,u(f);var t=r(f);t.e[12]=M=0>M?M>S?M:S:0,t.e[13]=P=0>P?P>D?P:D:0,v._el.transform("matrix3d",c(_=t))}},this.pinch=function(e){E=!0,y=e.gesture,f=v.scale*y.scale,1>f&&(f=1),f>4&&(f=4),u(f),Q=(v.scale-f)*v.width*v.centerX+m+M,I=(v.scale-f)*v.height*v.centerY+g+M;var t=r(f);t.e[12]=Q=0>Q?Q>S?Q:S:0,t.e[13]=I=0>I?I>D?I:D:0,v._el.transform("matrix3d",c(_=t))},this.transformEnd=function(){v.scale=f,v.transform=_,E=!0,m=Q,g=I,M=P=Q=I=0},this.dragEnd=function(){return A=!1,E?(E=!1,void 0):(v.transform=_,m=M,g=P,Q=I=M=P=0,void 0)},this.dragStart=function(){a(),E||(E=!1,A=!0)},l&&this._container.on("transformstart",this.transformStart).on("transform",this.pinch).on("transformend",this.transformEnd).on("dragstart",this.dragStart).on("drag",this.drag).on("dragend",this.dragEnd)}var r=e.fn.nchlightbox("access"),o=r.css3,l=!1,c=e(t).hammer();c.on("touch",s),e.fn.nchlightbox("access","pinch",function(t,i){var s;return e(this).each(function(r,o){var l;o=e(o),o.data("nch-pinchzoom",l=new a(o,t,i)),s===n?s=e(l.container):s.add(l.container)}),s})}(jQuery,window,document);